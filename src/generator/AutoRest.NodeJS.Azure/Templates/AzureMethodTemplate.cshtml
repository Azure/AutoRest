@using System
@using System.Linq
@using AutoRest.Core.Utilities
@using AutoRest.NodeJS.Model
@using AutoRest.NodeJS.Templates
@using AutoRest.NodeJS.Azure.Model
@inherits AutoRest.Core.Template<MethodJsa>

@if (!Model.IsLongRunningOperation)
{
@:@(Include( new MethodTemplate(), Model as MethodJs))
}
else
{
    <text>
@(Model.GenerateMethodDocumentation(MethodJs.MethodFlavor.HttpOperationResponse))
@(Model.MethodGroup.TypeName).prototype.@(Model.Name.ToCamelCase())WithHttpOperationResponse = function @(Model.Name.ToCamelCase())WithHttpOperationResponse(@(Model.MethodParameterDeclaration)) {
  let client = @(Model.ClientReference);
  let self = this;
  return new Promise((resolve, reject) => {
    self._@(Model.Name.ToCamelCase())(@(Model.MethodParameterDeclaration), (err, result, request, response) => {
      let httpOperationResponse = new HttpOperationResponse(request, response);
      httpOperationResponse.body = result;
      err ? reject(err) : resolve(httpOperationResponse);
      return;
    });
  });
};
@EmptyLine
@(Model.GenerateMethodDocumentation(MethodJs.MethodFlavor.Promise))
@(Model.MethodGroup.TypeName).prototype.@(Model.Name.ToCamelCase()) = function @(Model.Name.ToCamelCase())(@(Model.MethodParameterDeclarationWithCallback(true))) {
  let client = @(Model.ClientReference);
  let self = this;
  if (!optionalCallback && typeof options === 'function') {
    optionalCallback = options;
    options = null;
  }
  if (!optionalCallback) {
    return new Promise((resolve, reject) => {
      self._@(Model.Name.ToCamelCase())(@(Model.MethodParameterDeclaration), (err, result, request, response) => {
        err ? reject(err) : resolve(result);
        return;
      });
    });
  } else {
    return self._@(Model.Name.ToCamelCase())(@(Model.MethodParameterDeclarationWithCallback(true)));
  }
};
@EmptyLine
@(Model.GenerateMethodDocumentation(MethodJs.MethodFlavor.Callback))
function _@(Model.Name.ToCamelCase())(@(Model.MethodParameterDeclarationWithCallback())) {
  var client = @(Model.ClientReference);
  if(!callback && typeof options === 'function') {
    callback = options;
    options = null;
  }
  @EmptyLine
  if (!callback) {
    throw new Error('callback cannot be null.');
  }
  @EmptyLine
  // Send request
  this.begin@(Model.Name.ToPascalCase())(@(Model.MethodParameterDeclaration), (err, parsedResult, httpRequest, response) => {
    if (err) return callback(err);
    @EmptyLine
    var initialResult = new msRest.HttpOperationResponse();
    initialResult.request = httpRequest;
    initialResult.response = response;
    initialResult.body = response.body;
    client.@(Model.LongRunningOperationMethodNameInRuntime)(initialResult, options, (err, pollingResult) => {
      if (err) return callback(err);
      @EmptyLine
      // Create Result
      var result = null;
      httpRequest = pollingResult.request;
      response = pollingResult.response;
      var responseBody = pollingResult.body;
      if (responseBody === '') responseBody = null;
      @EmptyLine
      // Deserialize Response
      @if (Model.ReturnType.Body != null)
      {
      @:@(Model.DeserializeResponse(Model.ReturnType.Body))
      }

      @if (Model.ReturnType.Body != null && Model.DefaultResponse.Body != null && !Model.Responses.Any())
      {
      @:@(Model.DeserializeResponse(Model.DefaultResponse.Body))
      }
      @EmptyLine
      return callback(null, result, httpRequest, response);
    });
  });
};
    </text>
}
